<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿å•†åŸ</title>
    <!-- æ ¸å¿ƒä¾èµ–å¼•å…¥ï¼ˆä»…ä¿ç•™å¿…è¦èµ„æºï¼‰ -->
     <link href="./js/element/index.css" rel="stylesheet" type="text/css">
    <script src="./js/vue/vue/vue-2.7.6.min.js"></script>
    <script src="./js/element/index.js"></script>
    <script src="./js/vue/vue/axios.min.js"></script>
   

    <style>
        /* ä¿ç•™æ ¸å¿ƒæ ·å¼ï¼Œåˆ é™¤æœªä½¿ç”¨å†—ä½™æ ·å¼ */
        html, body {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 50%, #fdf2f8 100%);
            padding: 0;
            margin: 0;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            min-height: 100vh;
        }

        #shopApp {
            background-color: transparent;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* å¯¼èˆªæ æ ¸å¿ƒæ ·å¼ */
        .navbar {
            background: linear-gradient(to right, rgba(255, 255, 255, 0.98), rgba(252, 231, 243, 0.95));
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 18px 0;
            margin-bottom: 0;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            box-sizing: border-box;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #ec4899, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }

        /* å•†å“åˆ—è¡¨æ ¸å¿ƒæ ·å¼ */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 0;
            padding: 0 10px;
            width: 100%;
        }

        .product-card {
            background: linear-gradient(to bottom, #ffffff, #fefefe);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.12);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(236, 72, 153, 0.1);
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 35px rgba(236, 72, 153, 0.2);
            border-color: rgba(236, 72, 153, 0.3);
        }

        .product-image {
            width: 100%;
            height: 240px;
            background: linear-gradient(135deg, #fdf2f8, #fce7f3);
            overflow: hidden;
            position: relative;
        }

        .product-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 60%, rgba(255,255,255,0.3));
            pointer-events: none;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .product-card:hover .product-image img {
            transform: scale(1.1);
        }

        .product-info {
            padding: 22px 20px;
            background: linear-gradient(to bottom, #ffffff, #fefefe);
        }

        .product-name {
            font-size: 19px;
            font-weight: 700;
            color: #2d3748;
            margin: 0 0 8px 0;
            line-height: 1.4;
            letter-spacing: 0.3px;
        }

        .product-desc {
            font-size: 14px;
            color: #718096;
            margin: 0 0 15px 0;
            line-height: 1.5;
            height: 42px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-price {
            font-size: 24px;
            background: linear-gradient(135deg, #ec4899, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            margin-bottom: 18px;
            letter-spacing: 0.5px;
        }

        .add-to-cart-btn {
            width: 100%;
            background: linear-gradient(135deg, #ec4899, #f97316);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 14px 0;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
            letter-spacing: 0.5px;
        }

        .add-to-cart-btn:hover {
            background: linear-gradient(135deg, #f97316, #ec4899);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4);
        }

        .add-to-cart-btn:disabled {
            background-color: #ddd;
            color: #999;
            cursor: not-allowed;
        }

        /* è´­ç‰©è½¦æ ¸å¿ƒæ ·å¼ */
        .cart-summary {
            background: linear-gradient(to right, rgba(255, 255, 255, 0.98), rgba(252, 231, 243, 0.95));
            border-radius: 16px;
            padding: 25px 30px;
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 30px rgba(236, 72, 153, 0.15);
            border: 1px solid rgba(236, 72, 153, 0.1);
        }

        .total-price {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #ec4899, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ç®¡ç†å‘˜é¢æ¿æ ¸å¿ƒæ ·å¼ */
        .admin-panel {
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.98), rgba(252, 231, 243, 0.95));
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 8px 30px rgba(236, 72, 153, 0.15);
            border: 1px solid rgba(236, 72, 153, 0.1);
        }

        .admin-toolbar {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* å“åº”å¼æ ¸å¿ƒé€‚é… */
        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .product-image {
                height: 200px;
            }
            
            .navbar-content {
                flex-wrap: wrap;
                gap: 15px;
                padding: 0 15px;
            }
            
            .el-input {
                width: 100% !important;
                margin: 10px 0 !important;
            }

            .carousel-container {
                height: 250px;
                margin: 20px auto 0;
            }

            .container {
                padding: 0 15px;
            }
        }

        /* è½®æ’­å›¾å®¹å™¨ï¼šä¼˜åŒ–æ¯”ä¾‹å’Œè§†è§‰æ•ˆæœ */
        .carousel-container {
            width: 100%;
            max-width: 100%;
            height: 380px;
            margin: 0;
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(236, 72, 153, 0.1);
            position: relative;
            border: none;
            background-color: #fdf2f8;
        }

        /* è½®æ’­å›¾ç»„ä»¶ */
        .el-carousel {
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
        }

        /* è½®æ’­å›¾é¡¹ */
        .el-carousel-item {
            margin: 0 !important;
            padding: 0 !important;
            position: relative;
            width: 100% !important;
            height: 100% !important;
        }

        /* å›¾ç‰‡æ ·å¼ï¼šå¡«å……æ•´ä¸ªå®¹å™¨ */
        .carousel-img {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            object-position: center !important;
            transition: transform 0.6s ease;
            display: block !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* è½®æ’­å›¾æ‚¬åœæ•ˆæœ */
        .el-carousel-item:hover .carousel-img {
            transform: scale(1.05);
        }

        /* è½®æ’­å›¾æŒ‡ç¤ºå™¨ç¾åŒ– - æ”¾åœ¨å›¾ç‰‡å†…éƒ¨åº•éƒ¨ */
        .carousel-container >>> .el-carousel__indicator {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .carousel-container >>> .el-carousel__indicator.is-active {
            background: linear-gradient(135deg, #ec4899, #f97316);
        }

        .carousel-container >>> .el-carousel__indicators {
            bottom: 15px;
        }

        /* ç§»é™¤ Element UI é»˜è®¤çš„å†…è¾¹è·å’Œè¾¹è· */
        .carousel-container >>> .el-carousel__container {
            height: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }
    </style>
</head>
<body>
    <div id="shopApp">
        <!-- å¯¼èˆªæ ï¼ˆä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼šLogoã€æœç´¢ã€è´­ç‰©è½¦ã€ç™»å½•ã€ç®¡ç†å‘˜å…¥å£ï¼‰ -->
        <div class="navbar">
            <div class="navbar-content">
                <div class="logo">åœ¨çº¿å•†åŸ</div>
                
                <!-- æœç´¢æ¡†ï¼ˆåç«¯äº¤äº’ï¼šå…³é”®è¯æœç´¢å•†å“ï¼‰ -->
                <el-input v-model="searchKeyword" placeholder="æœç´¢å•†å“..." style="width: 400px; margin: 0 20px;"
                    @keyup.enter.native="searchProducts">
                    <el-button slot="append" icon="el-icon-search" @click="searchProducts"></el-button>
                </el-input>
                
                <div>
                    <!-- è´­ç‰©è½¦ï¼ˆåç«¯äº¤äº’ï¼šæŸ¥çœ‹è´­ç‰©è½¦ï¼‰ -->
                    <el-badge :value="cartCount" :hidden="cartCount === 0">
                        <el-button @click="showCart">è´­ç‰©è½¦</el-button>
                    </el-badge>
                    
                    <!-- ç®¡ç†å‘˜å…¥å£ï¼ˆåç«¯äº¤äº’ï¼šç®¡ç†å‘˜ç™»å½•ï¼‰ -->
                    <el-button v-if="!isAdminMode" type="warning" @click="enterAdminMode" style="margin-left: 10px;">ç®¡ç†åå°</el-button>
                    
                    <!-- ç™»å½•/ç”¨æˆ·èœå•ï¼ˆåç«¯äº¤äº’ï¼šç™»å½•/æ³¨å†Œ/é€€å‡ºï¼‰ -->
                    <el-button v-if="!currentUser" type="primary" @click="showLoginDialog" style="margin-left: 10px;">ç™»å½•</el-button>
                    <el-dropdown v-else @command="handleUserCommand" style="margin-left: 10px;">
                        <span style="cursor: pointer;">æ¬¢è¿, {{currentUser.username}}<i class="el-icon-arrow-down el-icon--right"></i></span>
                        <el-dropdown-menu slot="dropdown">
                            <el-dropdown-item command="logout">é€€å‡ºç™»å½•</el-dropdown-item>
                        </el-dropdown-menu>
                    </el-dropdown>
                </div>
            </div>
        </div>

        <!-- ç”œå“è½®æ’­å›¾ï¼šä»…åœ¨å•†å“åˆ—è¡¨é¡µé¢æ˜¾ç¤ºï¼Œç®¡ç†å‘˜æ¨¡å¼éšè— -->
        <div v-show="!isAdminMode && currentPage === 'products'" class="carousel-container">
            <el-carousel autoplay interval="5000" indicator-position="none" arrow="hover" height="380px">
                <!-- autoplayï¼šè‡ªåŠ¨æ’­æ”¾ï¼›intervalï¼šåˆ‡æ¢é—´éš”5ç§’ï¼›indicator-positionï¼šnoneéšè—æŒ‡ç¤ºå™¨ï¼›arrowï¼šhoveræ˜¾ç¤ºç®­å¤´ -->
                <!-- è½®æ’­å›¾é¡¹1ï¼šç²¾ç¾ç”œå“æ‹¼ç›˜ -->
                <el-carousel-item>
                    <img src="https://images.unsplash.com/photo-1488477181946-6428a0291777?w=1920&h=672&fit=crop" alt="ç²¾ç¾ç”œå“æ‹¼ç›˜" class="carousel-img">
                </el-carousel-item>
                <!-- è½®æ’­å›¾é¡¹2ï¼šé©¬å¡é¾™ç”œå“ -->
                <el-carousel-item>
                    <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1920&h=672&fit=crop" alt="é©¬å¡é¾™ç”œå“" class="carousel-img">
                </el-carousel-item>
                <!-- è½®æ’­å›¾é¡¹3ï¼šå·§å…‹åŠ›è›‹ç³• -->
                <el-carousel-item>
                    <img src="https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=1920&h=672&fit=crop" alt="å·§å…‹åŠ›è›‹ç³•" class="carousel-img">
                </el-carousel-item>
                <!-- è½®æ’­å›¾é¡¹4ï¼šç”œå“åº—å±•ç¤º -->
                <el-carousel-item>
                    <img src="https://images.unsplash.com/photo-1486427944299-d1955d23e34d?w=1920&h=672&fit=crop" alt="ç”œå“åº—å±•ç¤º" class="carousel-img">
                </el-carousel-item>
            </el-carousel>
        </div>

        <div class="container">

            <!-- å•†å“åˆ—è¡¨é¡µé¢ï¼ˆåç«¯äº¤äº’ï¼šåŠ è½½å•†å“ã€æ·»åŠ è´­ç‰©è½¦ï¼‰ -->
            <div v-show="!isAdminMode && currentPage === 'products'">
                <h2 style="color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin: 20px 0 15px 0;">å•†å“åˆ—è¡¨</h2>
                <div class="product-grid">
                    <div v-for="product in products" :key="product.id" class="product-card">
                        <div class="product-image">
                            <img v-if="getProductImageUrl(product)" :src="getProductImageUrl(product)" :alt="product.name">
                            <span v-else style="font-size: 48px; display: flex; align-items: center; justify-content: center; height: 100%;">ğŸ°</span>
                        </div>
                        <div class="product-info">
                            <div class="product-name">{{product.name}}</div>
                            <div v-if="product.description" class="product-desc">{{product.description}}</div>
                            <div class="product-price">Â¥{{product.price}}</div>
                            <button class="add-to-cart-btn" :disabled="product.stock <= 0" @click="addToCart(product.id)">
                                {{product.stock <= 0 ? 'å·²å”®ç½„' : 'åŠ å…¥è´­ç‰©è½¦'}}
                            </button>
                        </div>
                    </div>
                </div>
                <el-empty v-if="products.length === 0" description="æš‚æ— å•†å“"></el-empty>
            </div>



            <!-- è´­ç‰©è½¦é¡µé¢ï¼ˆåç«¯äº¤äº’ï¼šåŠ è½½è´­ç‰©è½¦ã€æ›´æ–°æ•°é‡ã€åˆ é™¤å•†å“ã€ç»“ç®—ï¼‰ -->
            <div v-show="!isAdminMode && currentPage === 'cart'">
                <el-button @click="backToProducts" icon="el-icon-back" style="margin-bottom: 15px;">è¿”å›å•†å“åˆ—è¡¨</el-button>
                <h2 style="color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">è´­ç‰©è½¦</h2>
                
                <el-card v-if="cartItems.length > 0">
                    <el-table :data="cartItems" style="width: 100%">
                        <el-table-column label="å•†å“" width="300">
                            <template slot-scope="scope">
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                                        <img v-if="getProductImageUrl(scope.row.product)" :src="getProductImageUrl(scope.row.product)" style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px;">
                                        <span v-else style="font-size: 24px;">ğŸ›ï¸</span>
                                    </div>
                                    <span style="font-weight: 600;">{{scope.row.product.name}}</span>
                                </div>
                            </template>
                        </el-table-column>
                        <el-table-column label="å•ä»·" width="120">
                            <template slot-scope="scope">
                                <span style="color: #409EFF; font-weight: bold;">Â¥{{scope.row.product.price}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="æ•°é‡" width="180">
                            <template slot-scope="scope">
                                <el-input-number v-model="scope.row.quantity" :min="1" @change="updateCartQuantity(scope.row)" size="small"></el-input-number>
                            </template>
                        </el-table-column>
                        <el-table-column label="å°è®¡">
                            <template slot-scope="scope">
                                <span style="color: #409EFF; font-weight: bold;">Â¥{{(scope.row.product.price * scope.row.quantity).toFixed(2)}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column label="æ“ä½œ" width="100">
                            <template slot-scope="scope">
                                <el-button type="danger" icon="el-icon-delete" size="small" @click="removeFromCart(scope.row.id)">åˆ é™¤</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </el-card>
                
                <el-empty v-else description="è´­ç‰©è½¦æ˜¯ç©ºçš„">
                    <el-button type="primary" @click="backToProducts">ç»§ç»­è´­ç‰©</el-button>
                </el-empty>
                
                <div v-if="cartItems.length > 0" class="cart-summary">
                    <div class="total-price">æ€»è®¡: Â¥{{totalPrice}}</div>
                    <el-button type="success" size="large" icon="el-icon-shopping-cart-full" @click="checkout">å¾®ä¿¡ç»“ç®—</el-button>
                </div>
            </div>

            <!-- ç®¡ç†å‘˜é¡µé¢ï¼ˆåç«¯äº¤äº’ï¼šå•†å“CRUDï¼‰ -->
            <div v-show="isAdminMode" class="admin-panel">
                <div class="admin-toolbar">
                    <h2 style="color: #409EFF; margin: 0;">å•†å“ç®¡ç†</h2>
                    <div>
                        <el-button type="primary" @click="showAddProductDialog">æ·»åŠ å•†å“</el-button>
                        <el-button @click="refreshProducts">åˆ·æ–°</el-button>
                        <el-button type="info" @click="exitAdminMode">é€€å‡ºç®¡ç†</el-button>
                    </div>
                </div>
                
                <el-table :data="products" style="width: 100%" border>
                    <el-table-column prop="id" label="ID" width="80"></el-table-column>
                    <el-table-column prop="name" label="å•†å“åç§°"></el-table-column>
                    <el-table-column prop="price" label="ä»·æ ¼" width="120">
                        <template slot-scope="scope">Â¥{{ scope.row.price }}</template>
                    </el-table-column>
                    <el-table-column prop="stock" label="åº“å­˜" width="120"></el-table-column>
                    <el-table-column prop="description" label="æè¿°"></el-table-column>
                    <el-table-column label="æ“ä½œ" width="200">
                        <template slot-scope="scope">
                            <el-button size="mini" @click="showEditProductDialog(scope.row)">ç¼–è¾‘</el-button>
                            <el-button size="mini" type="danger" @click="deleteProduct(scope.row.id)">åˆ é™¤</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
        </div>

        <!-- ç™»å½•/æ³¨å†Œå¼¹çª—ï¼ˆåç«¯äº¤äº’ï¼šç™»å½•/æ³¨å†Œï¼‰ -->
        <el-dialog :title="authDialogTitle" :visible.sync="authDialogVisible" width="400px">
            <el-tabs v-model="activeAuthTab">
                <el-tab-pane label="ç™»å½•" name="login">
                    <el-form :model="loginForm" label-width="80px">
                        <el-form-item label="ç”¨æˆ·å">
                            <el-input v-model="loginForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å"></el-input>
                        </el-form-item>
                        <el-form-item label="å¯†ç ">
                            <el-input v-model="loginForm.password" type="password" placeholder="è¯·è¾“å…¥å¯†ç " @keyup.enter.native="login"></el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="login" style="width: 100%;">ç™»å½•</el-button>
                        </el-form-item>
                    </el-form>
                </el-tab-pane>
                <el-tab-pane label="æ³¨å†Œ" name="register">
                    <el-form :model="registerForm" label-width="80px">
                        <el-form-item label="ç”¨æˆ·å">
                            <el-input v-model="registerForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å"></el-input>
                        </el-form-item>
                        <el-form-item label="å¯†ç ">
                            <el-input v-model="registerForm.password" type="password" placeholder="è¯·è¾“å…¥å¯†ç "></el-input>
                        </el-form-item>
                        <el-form-item label="ç¡®è®¤å¯†ç ">
                            <el-input v-model="registerForm.confirmPassword" type="password" placeholder="è¯·ç¡®è®¤å¯†ç " @keyup.enter.native="register"></el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="register" style="width: 100%;">æ³¨å†Œ</el-button>
                        </el-form-item>
                    </el-form>
                </el-tab-pane>
            </el-tabs>
        </el-dialog>

        <!-- ç®¡ç†å‘˜ç™»å½•å¼¹çª—ï¼ˆåç«¯äº¤äº’ï¼šç®¡ç†å‘˜ç™»å½•ï¼‰ -->
        <el-dialog title="ç®¡ç†å‘˜ç™»å½•" :visible.sync="adminLoginDialogVisible" width="400px">
            <el-form :model="adminLoginForm" label-width="80px">
                <el-form-item label="ç”¨æˆ·å">
                    <el-input v-model="adminLoginForm.username" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·å"></el-input>
                </el-form-item>
                <el-form-item label="å¯†ç ">
                    <el-input v-model="adminLoginForm.password" type="password" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " @keyup.enter.native="adminLogin"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="adminLogin" style="width: 100%;">ç™»å½•</el-button>
                </el-form-item>
            </el-form>
        </el-dialog>

        <!-- å•†å“æ·»åŠ /ç¼–è¾‘å¼¹çª—ï¼ˆåç«¯äº¤äº’ï¼šæ·»åŠ /æ›´æ–°å•†å“ï¼‰ -->
        <el-dialog :title="productDialog.title" :visible.sync="productDialog.visible" width="500px">
            <el-form :model="productDialog.form" label-width="80px">
                <el-form-item label="å•†å“ID">
                    <el-input v-model.number="productDialog.form.id" type="number" placeholder="è¯·è¾“å…¥å•†å“ID" :readonly="productDialog.isEdit"></el-input>
                    <span v-if="!productDialog.isEdit" style="font-size: 12px; color: #999;">* è¯·è¾“å…¥å”¯ä¸€çš„å•†å“ç¼–å·</span>
                </el-form-item>
                <el-form-item label="å•†å“åç§°">
                    <el-input v-model="productDialog.form.name" placeholder="è¯·è¾“å…¥å•†å“åç§°"></el-input>
                </el-form-item>
                <el-form-item label="ä»·æ ¼">
                    <el-input v-model.number="productDialog.form.price" type="number" placeholder="è¯·è¾“å…¥ä»·æ ¼"></el-input>
                </el-form-item>
                <el-form-item label="åº“å­˜">
                    <el-input v-model.number="productDialog.form.stock" type="number" placeholder="è¯·è¾“å…¥åº“å­˜æ•°é‡"></el-input>
                </el-form-item>
                <el-form-item label="æè¿°">
                    <el-input v-model="productDialog.form.description" type="textarea" placeholder="è¯·è¾“å…¥å•†å“æè¿°"></el-input>
                </el-form-item>
                <el-form-item label="å›¾ç‰‡URL">
                    <el-input v-model="productDialog.form.imageUrl" placeholder="è¯·è¾“å…¥å›¾ç‰‡URL"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="saveProduct" style="width: 100%;">ä¿å­˜</el-button>
                </el-form-item>
            </el-form>
        </el-dialog>
    </div>

    <script>
        // Axioså®ä¾‹ï¼ˆåç«¯äº¤äº’æ ¸å¿ƒï¼‰
        // æ³¨æ„ï¼šå¯åŠ¨ ngrok åï¼Œå°†ä¸‹é¢çš„åœ°å€æ›¿æ¢ä¸º ngrok ç”Ÿæˆçš„åœ°å€
        // ä¾‹å¦‚ï¼š'https://abc-123-def.ngrok-free.app'
        var xhr = axios.create({
            baseURL: 'http://localhost:8080'  // æœ¬åœ°æµ‹è¯•ç”¨
            // baseURL: 'https://ä½ çš„ngrokåœ°å€.ngrok-free.app'  // è€å¸ˆè®¿é—®ç”¨ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶æ›¿æ¢åœ°å€
        });

        // Vueæ ¸å¿ƒå®ä¾‹
        var shopApp = new Vue({
            el: '#shopApp',
            data: {
                // æ ¸å¿ƒæ•°æ®ï¼ˆä»…ä¿ç•™åç«¯äº¤äº’ç›¸å…³ï¼‰
                searchKeyword: '',
                currentPage: 'products',
                products: [],
                cartItems: [],
                currentUser: null,
                isAdminMode: false,
                authDialogVisible: false,
                adminLoginDialogVisible: false,
                authDialogTitle: 'ç™»å½•/æ³¨å†Œ',
                activeAuthTab: 'login',
                // è¡¨å•æ•°æ®
                loginForm: { username: '', password: '' },
                registerForm: { username: '', password: '', confirmPassword: '' },
                adminLoginForm: { username: '', password: '' },
                productDialog: {
                    title: '',
                    visible: false,
                    form: { id: null, name: '', price: 0, stock: 0, description: '', imageUrl: '' },
                    isEdit: false
                }
            },
            computed: {
                // è´­ç‰©è½¦æ ¸å¿ƒè®¡ç®—å±æ€§
                cartCount() {
                    return this.cartItems.reduce((sum, item) => sum + item.quantity, 0);
                },
                totalPrice() {
                    return this.cartItems.reduce((sum, item) => sum + (item.product.price * item.quantity), 0).toFixed(2);
                }
            },
            mounted() {
                this.initApp(); // åˆå§‹åŒ–åŠ è½½
            },
            methods: {
                // åˆå§‹åŒ–ï¼ˆåŠ è½½ç”¨æˆ·çŠ¶æ€+å•†å“ï¼‰
                initApp() {
                    const savedUser = localStorage.getItem('currentUser');
                    if (savedUser) {
                        this.currentUser = JSON.parse(savedUser);
                        this.updateCartCount();
                    }
                    this.loadProducts();
                },

                // å•†å“ç›¸å…³ï¼ˆåç«¯äº¤äº’ï¼‰
                loadProducts(keyword = '') {
                    let url = '/api/products' + (keyword ? '?keyword=' + encodeURIComponent(keyword) : '');
                    xhr.get(url).then(res => this.products = res.data || []).catch(() => {
                        this.$message.error('åŠ è½½å•†å“å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡');
                    });
                },
                searchProducts() {
                    this.loadProducts(this.searchKeyword);
                },

                // è´­ç‰©è½¦ç›¸å…³ï¼ˆåç«¯äº¤äº’ï¼‰
                addToCart(productId) {
                    if (!this.currentUser) return this.$message.warning('è¯·å…ˆç™»å½•') && this.showLoginDialog();
                    xhr.post('/api/cart', { userId: this.currentUser.id, productId, quantity: 1 }).then(() => {
                        this.$message.success('å·²åŠ å…¥è´­ç‰©è½¦');
                        this.updateCartCount();
                    }).catch(err => {
                        this.$message.error(err.response?.data?.error || 'æ·»åŠ è´­ç‰©è½¦å¤±è´¥');
                    });
                },
                showCart() {
                    if (!this.currentUser) return this.$message.warning('è¯·å…ˆç™»å½•') && this.showLoginDialog();
                    this.currentPage = 'cart';
                    this.loadCart();
                },
                loadCart() {
                    xhr.get('/api/cart?userId=' + this.currentUser.id).then(res => {
                        this.cartItems = res.data || [];
                    }).catch(() => this.$message.error('åŠ è½½è´­ç‰©è½¦å¤±è´¥'));
                },
                updateCartQuantity(cartItem) {
                    xhr.put('/api/cart', { id: cartItem.id, quantity: cartItem.quantity }).then(() => {
                        this.$message.success('æ›´æ–°æˆåŠŸ');
                        this.loadCart();
                    }).catch(() => this.$message.error('æ›´æ–°å¤±è´¥'));
                },
                removeFromCart(cartId) {
                    this.$confirm('ç¡®å®šåˆ é™¤ï¼Ÿ', 'è­¦å‘Š', { type: 'warning' }).then(() => {
                        xhr.delete('/api/cart?id=' + cartId).then(() => {
                            this.$message.success('å·²ç§»é™¤');
                            this.loadCart();
                        }).catch(() => this.$message.error('åˆ é™¤å¤±è´¥'));
                    }).catch(() => {});
                },
                updateCartCount() {
                    if (this.currentUser) this.loadCart();
                },
                checkout() {
                    if (this.cartItems.length === 0) {
                        return this.$message.warning('è´­ç‰©è½¦æ˜¯ç©ºçš„');
                    }
                    // æ˜¾ç¤ºå¾®ä¿¡æ”¶æ¬¾ç å¼¹çª—
                    this.$alert(
                        '<div style="text-align: center;">' +
                        '<p style="font-size: 18px; font-weight: bold; margin-bottom: 15px;">è¯·æ‰«ç æ”¯ä»˜ Â¥' + this.totalPrice + '</p>' +
                        '<img src="./image/wechat-pay.jpg" style="width: 300px; height: 300px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" alt="å¾®ä¿¡æ”¶æ¬¾ç ">' +
                        '<p style="margin-top: 15px; color: #666;">æ‰«ç åè¯·è”ç³»å®¢æœç¡®è®¤è®¢å•</p>' +
                        '</div>',
                        'å¾®ä¿¡æ”¯ä»˜',
                        {
                            dangerouslyUseHTMLString: true,
                            confirmButtonText: 'å·²å®Œæˆæ”¯ä»˜',
                            callback: action => {
                                if (action === 'confirm') {
                                    // æ¸…ç©ºè´­ç‰©è½¦ï¼ˆåç«¯äº¤äº’ï¼‰
                                    this.clearCart();
                                    this.$message.success('æ”¯ä»˜æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„è´­ä¹°ï¼Œè¯·è”ç³»å®¢æœç¡®è®¤è®¢å•');
                                    // è·³è½¬å›å•†å“åˆ—è¡¨
                                    this.backToProducts();
                                }
                            }
                        }
                    );
                },

                // æ¸…ç©ºè´­ç‰©è½¦
                clearCart() {
                    // è°ƒç”¨åç«¯æ¥å£æ¸…ç©ºè´­ç‰©è½¦
                    xhr.delete('/api/cart?clearAll=true&userId=' + this.currentUser.id).then(() => {
                        // æ¸…ç©ºæœ¬åœ°è´­ç‰©è½¦æ•°æ®
                        this.cartItems = [];
                    }).catch(() => {
                        // å³ä½¿åç«¯å¤±è´¥ä¹Ÿæ¸…ç©ºæœ¬åœ°æ•°æ®
                        this.cartItems = [];
                    });
                },

                // ç”¨æˆ·è®¤è¯ç›¸å…³ï¼ˆåç«¯äº¤äº’ï¼‰
                showLoginDialog() {
                    this.authDialogVisible = true;
                    this.activeAuthTab = 'login';
                },
                login() {
                    if (!this.loginForm.username || !this.loginForm.password) return this.$message.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                    xhr.get('/api/users?username=' + encodeURIComponent(this.loginForm.username)).then(res => {
                        const user = res.data;
                        if (user && user.password === this.loginForm.password) {
                            this.currentUser = user;
                            localStorage.setItem('currentUser', JSON.stringify(user));
                            this.authDialogVisible = false;
                            this.$message.success('ç™»å½•æˆåŠŸ');
                            this.updateCartCount();
                            this.loginForm = { username: '', password: '' };
                        } else {
                            this.$message.error(user ? 'å¯†ç é”™è¯¯' : 'ç”¨æˆ·ä¸å­˜åœ¨');
                        }
                    }).catch(() => this.$message.error('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡'));
                },
                register() {
                    const { username, password, confirmPassword } = this.registerForm;
                    if (!username || !password || !confirmPassword) return this.$message.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                    if (password !== confirmPassword) return this.$message.error('ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´');
                    xhr.post('/api/users', { username, password }).then(() => {
                        this.$message.success('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
                        this.activeAuthTab = 'login';
                        this.loginForm.username = username;
                        this.registerForm = { username: '', password: '', confirmPassword: '' };
                    }).catch(() => this.$message.error('æ³¨å†Œå¤±è´¥'));
                },
                logout() {
                    this.currentUser = null;
                    this.isAdminMode = false;
                    localStorage.removeItem('currentUser');
                    this.cartItems = [];
                    this.currentPage = 'products';
                    this.$message.success('å·²é€€å‡ºç™»å½•');
                },
                handleUserCommand(command) {
                    if (command === 'logout') this.logout();
                },

                // ç®¡ç†å‘˜ç›¸å…³ï¼ˆåç«¯äº¤äº’ï¼‰
                enterAdminMode() {
                    this.adminLoginDialogVisible = true;
                },
                adminLogin() {
                    if (!this.adminLoginForm.username || !this.adminLoginForm.password) return this.$message.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                    const params = new URLSearchParams();
                    params.append('username', this.adminLoginForm.username);
                    params.append('password', this.adminLoginForm.password);
                    xhr.post('/api/admins', params, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }).then(res => {
                        if (res.data.success) {
                            this.isAdminMode = true;
                            this.adminLoginDialogVisible = false;
                            this.$message.success('ç®¡ç†å‘˜ç™»å½•æˆåŠŸ');
                            this.adminLoginForm = { username: '', password: '' };
                        } else {
                            this.$message.error(res.data.message);
                        }
                    }).catch(() => this.$message.error('ç®¡ç†å‘˜ç™»å½•å¤±è´¥'));
                },
                exitAdminMode() {
                    this.isAdminMode = false;
                    this.$message.success('å·²é€€å‡ºç®¡ç†åå°');
                },
                refreshProducts() {
                    this.loadProducts();
                    this.$message.success('å•†å“åˆ—è¡¨å·²åˆ·æ–°');
                },

                // å•†å“CRUDï¼ˆç®¡ç†å‘˜åç«¯äº¤äº’ï¼‰
                showAddProductDialog() {
                    this.productDialog = {
                        title: 'æ·»åŠ å•†å“',
                        visible: true,
                        form: { id: '', name: '', price: 0, stock: 0, description: '', imageUrl: '' },
                        isEdit: false
                    };
                },
                showEditProductDialog(product) {
                    this.productDialog = {
                        title: 'ç¼–è¾‘å•†å“',
                        visible: true,
                        form: { ...product, imageUrl: product.imageUrl || product.image_url || '' },
                        isEdit: true
                    };
                },
                saveProduct() {
                    const { form, isEdit } = this.productDialog;
                    if (!form.name || !form.price || form.stock === '' || (!isEdit && !form.id)) {
                        return this.$message.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                    }
                    const request = isEdit ? xhr.put('/api/products', form) : xhr.post('/api/products', form);
                    request.then(() => {
                        this.$message.success(isEdit ? 'å•†å“æ›´æ–°æˆåŠŸ' : 'å•†å“æ·»åŠ æˆåŠŸ');
                        this.productDialog.visible = false;
                        this.loadProducts();
                    }).catch(err => {
                        this.$message.error(err.response?.data?.error || (isEdit ? 'æ›´æ–°å¤±è´¥' : 'æ·»åŠ å¤±è´¥'));
                    });
                },
                deleteProduct(productId) {
                    this.$confirm('ç¡®å®šåˆ é™¤ï¼Ÿ', 'è­¦å‘Š', { type: 'warning' }).then(() => {
                        xhr.delete('/api/products?id=' + productId).then(() => {
                            this.$message.success('å•†å“åˆ é™¤æˆåŠŸ');
                            this.loadProducts();
                        }).catch(() => this.$message.error('åˆ é™¤å¤±è´¥'));
                    }).catch(() => {});
                },

                // å›¾ç‰‡URLå¤„ç†ï¼ˆé€‚é…åç«¯è¿”å›ï¼‰
                getProductImageUrl(product) {
                    if (product.imageUrl?.trim()) return product.imageUrl;
                    if (product.image_url?.trim()) {
                        return product.image_url.startsWith('D:\\') || product.image_url.startsWith('"D:\\') 
                            ? './image/' + product.image_url.substring(product.image_url.lastIndexOf('\\') + 1).replace(/"/g, '')
                            : product.image_url;
                    }
                    return product.id ? './image/product-' + product.id + '.jpg' : null;
                },

                // é¡µé¢åˆ‡æ¢
                backToProducts() {
                    this.currentPage = 'products';

                }
            }
        });
    </script>
</body>
</html>